import{r as m,j as e}from"./app-Da_nhggM.js";import{u as T,S as $}from"./SubAdminLayout-CzSuM2Ft.js";import{a as y}from"./axiosInstance-BO4ZrsK3.js";import{L as R}from"./Loader-DsengPFF.js";import{P as O}from"./plus-Ch-b2fYz.js";import{P as q}from"./pencil-BsWPgLZ3.js";import{T as V}from"./trash-2-D4oQZmeE.js";import{X as z}from"./x-Buk7JkW1.js";import"./menu-By4tiiDw.js";import"./createLucideIcon-Cl5mBFKr.js";import"./search-Cy0dovnH.js";import"./bell-Dmhy7b3m.js";import"./clsx-B-dksMZM.js";import"./layout-dashboard-DeJPl4RO.js";import"./file-text-DJmdbdJJ.js";import"./log-out-C0sdDckr.js";import"./loader-circle-BW8mmFDU.js";const G=["StudentManagementViewStudents","StudentManagementAddStudent","StudentManagementDeleteStudent","StudentManagementAddPreviousSchool","StudentManagementEditStudent","StudentManagementUploadPhoto","StudentManagementAssignRoll","StudentManagementDemoteStudent","StudentManagementPromoteStudent","StudentManagementGenerateIDCard","StudentManagementPrintList","StudentManagementFilterBySection","StudentManagementFilterByClass","StudentManagementFilterByBatch","StudentManagementViewProfile","StudentManagementResetPassword","StudentManagementEditProfilePicture","StudentManagementSendAnnouncement","StudentManagementUpdateGuardian","StudentManagementViewGuardian","StudentManagementAssignTransport","StudentManagementViewAttendance","StudentManagementViewFeeStatus","StudentManagementViewExamResult","StudentManagementBlockAccount","StudentManagementUnblockAccount","StudentManagementSuspendStudent","StudentManagementReinstateStudent","StudentManagementAssignHostel","StudentManagementRemoveHostel","StudentManagementBatchDelete","StudentManagementBatchEdit","StudentManagementBatchAdd","StudentManagementBatchShow","TeacherManagementAdd","TeacherManagementEdit","TeacherManagementDelete"];function H(){const{subadmin:i,permissions:a}=T(),[h,c]=m.useState([]),[x,o]=m.useState(!1),[s,w]=m.useState(!1),[A,v]=m.useState(null),[u,b]=m.useState({}),[B,M]=m.useState(!1),[l,j]=m.useState({name:"",email:"",role:"CollegeAdmin",permissions:[],status:"Active",token:"",password:""});m.useEffect(()=>{if(!(i!=null&&i.id))return;(async()=>{try{M(!0);const n=await y.get(`/subadmin/admins/${i.id}`);console.log("Fetched admin:",n.data),c(n.data.map(r=>({...r,permissions:Array.isArray(r.permissions)?r.permissions:JSON.parse(r.permissions||"[]")})))}catch(n){console.error("Error fetching admin:",n),alert("Failed to load users. Please try again.")}finally{M(!1)}})()},[i==null?void 0:i.id]);const k=(t=null)=>{if(t){const{id:n,password:r,...d}=t;j({...d,permissions:Array.isArray(d.permissions)?d.permissions:JSON.parse(d.permissions||"[]"),password:""}),v(n),w(!0)}else j({name:"",email:"",role:"CollegeAdmin",permissions:[],status:"Active",token:"",password:""}),w(!1),v(null);b({}),o(!0)},S=t=>{const{name:n,value:r}=t.target;j(d=>({...d,[n]:r})),b(d=>({...d,[n]:""}))},F=t=>{j(n=>{const r=n.permissions.includes(t)?n.permissions.filter(d=>d!==t):[...n.permissions,t];return{...n,permissions:r}}),b(n=>({...n,permissions:""}))},D=()=>{const t={};return l.name.trim()||(t.name="Name is required"),l.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)||(t.email="Invalid email format"):t.email="Email is required",!s&&!l.password.trim()&&(t.password="Password is required"),l.token.trim()||(t.token="Token is required"),l.permissions.length||(t.permissions="At least one permission is required"),t},I=async t=>{var d,E,U,C,P;t.preventDefault();const n=D();if(Object.keys(n).length>0){b(n);return}const r={...l,y:i==null?void 0:i.id};s&&!r.password.trim()&&delete r.password;try{if(s){const p=await y.put(`/subadmin/admins/${A}`,r);c(g=>g.map(f=>f.id===A?{...f,...p.data.admin}:f)),alert("User updated successfully.")}else{const p=await y.post("/subadmin/createAdmin",r);c(g=>[...g,p.data.admin]),alert("User created successfully.")}o(!1),w(!1),v(null),j({name:"",email:"",role:"CollegeAdmin",permissions:[],status:"Active",token:"",password:""}),b({})}catch(p){console.error("Error submitting form:",((d=p.response)==null?void 0:d.data)||p);const g=((U=(E=p.response)==null?void 0:E.data)==null?void 0:U.message)||(s?"Failed to update user":"Failed to create user"),f=((P=(C=p.response)==null?void 0:C.data)==null?void 0:P.errors)||{general:g};b(f),alert(`${g}. ${Object.values(f).join(" ")}`)}},L=async t=>{if(confirm("Are you sure you want to delete this user?"))try{await y.delete(`/subadmin/admins/${t}`),c(n=>n.filter(r=>r.id!==t)),alert("User deleted successfully.")}catch(n){console.error("Error deleting user:",n),alert("Failed to delete user. Please try again.")}};return e.jsxs("div",{className:"relative w-full",children:[e.jsxs("div",{className:"bg-white shadow p-4 rounded-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"User List"}),a.includes("SAUserAddButton")&&e.jsxs("button",{onClick:()=>k(),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(O,{size:18})," Add User"]})]}),B?e.jsx(R,{message:"Loading users..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border text-sm text-left",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 border-b",children:"Name"}),e.jsx("th",{className:"py-2 px-3 border-b",children:"Email"}),e.jsx("th",{className:"py-2 px-3 border-b",children:"Role"}),e.jsx("th",{className:"py-2 px-3 border-b",children:"Permissions"}),e.jsx("th",{className:"py-2 px-3 border-b",children:"Status"}),e.jsx("th",{className:"py-2 px-3 border-b",children:"Token"}),(a.includes("SAUserEditButton")||a.includes("SAUserDeleteButton"))&&e.jsx("th",{className:"py-2 px-3 border-b",children:"Actions"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3 border-b",children:t.name}),e.jsx("td",{className:"py-2 px-3 border-b",children:t.email}),e.jsx("td",{className:"py-2 px-3 border-b",children:t.role}),e.jsx("td",{className:"py-2 px-3 border-b text-xs",children:Array.isArray(t.permissions)?t.permissions.join(", "):"None"}),e.jsx("td",{className:"py-2 px-3 border-b",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-medium ${t.status==="active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"py-2 px-3 border-b",children:t.token||"â€”"}),(a.includes("SAUserEditButton")||a.includes("SAUserDeleteButton"))&&e.jsxs("td",{className:"py-2 px-3 border-b flex gap-2",children:[a.includes("SAUserEditButton")&&e.jsx("button",{onClick:()=>k(t),className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx(q,{size:16})}),a.includes("SAUserDeleteButton")&&e.jsx("button",{onClick:()=>L(t.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(V,{size:16})})]})]},t.id))})]})})]}),e.jsxs("div",{className:`fixed top-0 right-0 h-full w-full sm:max-w-md bg-white shadow-lg p-6 transition-transform duration-300 z-50 ${x?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s?"Edit User":"Add New User"}),e.jsx("button",{onClick:()=>o(!1),className:"text-gray-500 hover:text-red-500",children:e.jsx(z,{size:20})})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsx(N,{label:"Token",name:"token",value:l.token,onChange:S,error:u.token,isEditMode:s}),e.jsx(N,{label:"Name",name:"name",value:l.name,onChange:S,error:u.name,isEditMode:s}),e.jsx(N,{label:"Email",name:"email",value:l.email,onChange:S,type:"email",error:u.email,isEditMode:s}),!s&&e.jsx(N,{label:"Password",name:"password",value:l.password,onChange:S,type:"password",error:u.password,isEditMode:s}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Role"}),e.jsx("input",{type:"text",name:"role",value:l.role,disabled:!0,className:"w-full border px-3 py-2 rounded bg-gray-100 cursor-not-allowed"})]}),a.length>0&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Permissions ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-40 overflow-y-auto border p-2 rounded text-sm",children:G.filter(t=>a.includes(t)).map(t=>e.jsxs("label",{className:"flex items-center gap-2 break-all",children:[e.jsx("input",{type:"checkbox",checked:l.permissions.includes(t),onChange:()=>F(t)}),t]},t))}),u.permissions&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.permissions})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:l.status,onChange:S,className:"w-full border px-3 py-2 rounded",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),u.general&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:u.general}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:s?"Update User":"Save User"})]})]})]})}function N({label:i,name:a,value:h,onChange:c,type:x="text",error:o,isEditMode:s}){return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:[i," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:x,name:a,value:h,onChange:c,required:a!=="password"||!s,className:`w-full border px-3 py-2 rounded ${o?"border-red-500":""}`}),o&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:o})]})}const J=[{id:"home",label:"Home",component:e.jsx(H,{}),permission:"SATapCollegeMGMT"},{id:"about",label:"About",component:e.jsx("div",{children:"About section content"}),permission:null},{id:"contact",label:"Contact",component:e.jsx("div",{children:"Contact content"}),permission:null}];function _(){var o;const{permissions:i}=T(),a=m.useMemo(()=>J.filter(s=>!s.permission||i.includes(s.permission)),[i]),[h,c]=m.useState(((o=a[0])==null?void 0:o.id)||null),x=a.find(s=>s.id===h);return e.jsx("div",{className:"w-full",children:a.length===0?e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded text-red-600 font-medium",children:"You do not have access to any sections."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex space-x-4 border-b mb-4",children:a.map(s=>e.jsx("button",{onClick:()=>c(s.id),className:`px-4 py-2 text-sm font-medium border-b-2 transition-all duration-200 ${h===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-600 hover:text-blue-600"}`,children:s.label},s.id))}),e.jsx("div",{className:"w-full bg-white p-4 shadow rounded-md",children:x==null?void 0:x.component})]})})}function ce(){return e.jsxs($,{children:[e.jsx("div",{className:"w-full",children:e.jsx(_,{})}),"    "]})}export{ce as default};
