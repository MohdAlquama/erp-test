import{r as o,j as e}from"./app-Da_nhggM.js";import{A as ue}from"./AdminLayout-BFQKyw_n.js";import{a as N}from"./axiosInstance-BO4ZrsK3.js";import{u as ge}from"./adminContext-CI6wc_Go.js";import he from"./AdminCardTable-DnwiG6BK.js";import{P as be}from"./plus-Ch-b2fYz.js";import{U as pe}from"./users-SPycqOBZ.js";import{C as xe}from"./circle-plus-DQgevI2E.js";import"./index-CgiR4QPD.js";import"./menu-By4tiiDw.js";import"./createLucideIcon-Cl5mBFKr.js";import"./search-Cy0dovnH.js";import"./bell-Dmhy7b3m.js";import"./user-C3Ls9d9N.js";import"./x-Buk7JkW1.js";import"./house-BqJmp5lC.js";import"./graduation-cap-C0ne5fPE.js";import"./file-text-DJmdbdJJ.js";import"./settings-2yKiBYT4.js";import"./log-out-C0sdDckr.js";import"./Modal-BIo_idKR.js";import"./loader-circle-BW8mmFDU.js";import"./trash-2-D4oQZmeE.js";function ye(){const[B,w]=o.useState(!1),[_,v]=o.useState(!1),[q,b]=o.useState(null),[X,M]=o.useState(""),[p,Y]=o.useState([]),[C,Z]=o.useState([]),[je,O]=o.useState([]),[m,ee]=o.useState([]),[A,ae]=o.useState([]),[U,k]=o.useState([]),[R,E]=o.useState([]),[x,W]=o.useState(0),[z,T]=o.useState(0),[D,P]=o.useState([]),[H,G]=o.useState(!1),[c,J]=o.useState({collegeName:"",collegeLocation:"",subjectName:"",date:"",time:""}),[u,y]=o.useState([]),[K,j]=o.useState(null),[f,g]=o.useState(null),{admin:i}=ge(),Q=()=>{M(""),J({collegeName:"",collegeLocation:"",subjectName:"",date:"",time:""}),G(!1),k([]),E([]),P([]),y([]),T(0),W(0),j(null),g(null)};o.useEffect(()=>{const a=async()=>{var t,s,d,n,r;v(!0),b(null);try{const[l,h,L,$,F]=await Promise.all([N.get(`/admin/${i.id}/teachers`),N.get(`/admin/${i.id}/batches`),N.get(`/admin/${i.id}/subjects`),N.get(`/admin/${i.id}/class-rooms`),N.get(`/admin/${i.id}/students`)]);Y(((t=l.data.teachers)==null?void 0:t.data)||l.data.teachers||l.data||[]),Z(((s=h.data.batches)==null?void 0:s.data)||h.data.batches||h.data||[]),O(((d=L.data.subjects)==null?void 0:d.data)||L.data.subjects||L.data||[]),ee(((n=$.data.class_rooms)==null?void 0:n.data)||$.data.class_rooms||$.data||[]),ae(((r=F.data.students)==null?void 0:r.data)||F.data.students||F.data||[])}catch(l){b("Failed to fetch data. Please try again later."),console.error("API Error:",l)}finally{v(!1)}};i!=null&&i.id&&a()},[i==null?void 0:i.id]);const te=a=>{if(!(m!=null&&m.rooms)||m.rooms.length===0)return[];const t=[...m.rooms].sort((n,r)=>parseInt(r.room_type)-parseInt(n.room_type)),s=[];let d=a;for(const n of t){if(d<=0)break;const r=parseInt(n.room_type)||0;r>0&&(s.push({...n,assignedStudents:Math.min(d,r)}),d-=r)}return s},re=(a,t)=>{const s=[];let d=0;for(t.forEach(n=>{const r=n.assignedStudents||0;for(let l=0;l<r&&d<a.length;l++)s.push({student:a[d],room:n}),d++});d<a.length;)s.push({student:a[d],room:null}),d++;return s},se=a=>{const t=Number(a.target.value);if(W(t),M(t),t>0&&Array.isArray(A.data)){const s=A.data.filter(n=>n.batch_ids.includes(String(t))).length;T(s);const d=te(s);E(d),k(d.map(n=>n.id))}else T(0),E([]),k([]);y([]),j(null),g(null)},S=(a,t)=>{J(s=>({...s,[a]:t}))},de=(a,t)=>{if(!Array.isArray(a))return[];if(!Array.isArray(t)||t.length===0)return a.map(n=>({...n,teacher_name:null,teacher_id:null}));const s=[];let d=0;for(let n=0;n<a.length;n++){const r=t[d];s.push({...a[n],teacher_name:(r==null?void 0:r.name)||"",teacher_id:(r==null?void 0:r.id)||null}),d=(d+1)%t.length}return s},le=()=>{if(!x){b("Select a batch first.");return}const a=C.find(l=>l.id===x),t=Array.isArray(A.data)?A.data.filter(l=>l.batch_ids.includes(String(x))):[],s=p.filter(l=>D.includes(l.id)),d=de(t,s),r=re(d,R).map(({student:l,room:h})=>({student_id:l.id||null,student_name:l.name||l.full_name||"",teacher_id:l.teacher_id||null,teacher_name:l.teacher_name||null,class_id:(a==null?void 0:a.id)||null,class_name:(a==null?void 0:a.name)||(a==null?void 0:a.title)||"",college_name:c.collegeName,college_location:c.collegeLocation,subject_name:c.subjectName,date:c.date,time:c.time,room_id:(h==null?void 0:h.id)||null}));y(r),j(null),g(null)},ne=a=>{j(a),g({...u[a]})},I=(a,t)=>{g(s=>({...s,[a]:t}))},oe=a=>{const t=u.map((s,d)=>d===a?{...f}:s);y(t),j(null),g(null)},V=()=>{j(null),g(null)},ie=a=>{const t=u.filter((s,d)=>d!==a);y(t),K===a&&V()},ce=()=>{if(!x){b("Select a batch first");return}const a=C.find(s=>s.id===x),t={student_id:null,student_name:"NEW STUDENT",teacher_id:D[0]||null,teacher_name:(p.find(s=>s.id===(D[0]||null))||{}).name||"",class_id:(a==null?void 0:a.id)||null,class_name:(a==null?void 0:a.name)||"",college_name:c.collegeName,college_location:c.collegeLocation,subject_name:c.subjectName,date:c.date,time:c.time,room_id:U[0]||null};y(s=>[...s,t])},me=async a=>{a.preventDefault(),v(!0),b(null);try{const t=R.map(r=>({id:r.id,room_name:r.room_name,room_type:r.room_type,assigned_students:r.assignedStudents})),s=C.find(r=>r.id===x),d=u.map(r=>({student_id:r.student_id,student_name:r.student_name,teacher_id:r.teacher_id,teacher_name:r.teacher_name,class_id:r.class_id,class_name:r.class_name,college_name:r.college_name,college_location:r.college_location,subject_name:r.subject_name,date:r.date,time:r.time,room_id:r.room_id})),n={admin_id:i.id,admin_data:{id:i.id,name:i.name,email:i.email,status:"active"},batch_data:s,students_data:d,rooms_data:t,total_students:d.length,total_rooms_assigned:t.length,created_at:new Date().toISOString()};console.log("Final Admin Card Object:",n),await N.post(`/admin/${i.id}/admin-cards`,n),setTimeout(()=>{v(!1),w(!1),alert("Admin Card created successfully!"),Q()},800)}catch(t){console.error(t),b("Failed to create admin card. See console for details."),v(!1)}};return e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen",children:[q&&e.jsx("div",{className:"mb-4 text-red-500",children:q}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Design your Admin Card"}),e.jsxs("button",{onClick:()=>{Q(),w(!0)},className:"bg-indigo-600 text-white px-4 py-2 rounded flex items-center gap-2 hover:bg-indigo-700",disabled:_,children:[e.jsx(be,{className:"w-4 h-4"}),"Create Admin Card"]})]}),e.jsx(he,{}),B&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>w(!1)}),e.jsx("div",{className:"absolute right-0 top-0 h-full w-11/12 md:w-3/5 lg:w-1/2 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-lg overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Create Admin Card"}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Close"})]}),e.jsxs("form",{onSubmit:me,children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 mb-1",children:[e.jsx(pe,{size:18})," Batch"]}),e.jsxs("select",{value:X,onChange:se,className:"w-full border rounded p-2 bg-white dark:bg-gray-700",required:!0,children:[e.jsx("option",{value:"",children:"-- Select Batch --"}),C.map(a=>e.jsxs("option",{value:a.id,children:[a.name," ",a.grade?`(${a.grade})`:""]},a.id))]})]}),z>0&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900 rounded",children:e.jsxs("p",{className:"text-sm font-semibold",children:["Students in batch: ",z]})}),R.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900 rounded",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Auto-assigned Rooms"}),R.map((a,t)=>e.jsxs("div",{className:"text-sm mb-1",children:[e.jsx("span",{className:"font-medium",children:a.room_name})," (Capacity: ",a.room_type,") â€” Assigned: ",a.assignedStudents]},t))]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 cursor-pointer text-indigo-600 hover:text-indigo-800",onClick:()=>G(a=>!a),children:[e.jsx(xe,{}),e.jsx("span",{children:H?"Hide Details":"Add Details"})]}),H&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("input",{placeholder:"College name",className:"border rounded p-2 w-full bg-white dark:bg-gray-700",value:c.collegeName,onChange:a=>S("collegeName",a.target.value),required:!0}),e.jsx("input",{placeholder:"College location",className:"border rounded p-2 w-full bg-white dark:bg-gray-700",value:c.collegeLocation,onChange:a=>S("collegeLocation",a.target.value),required:!0}),e.jsx("input",{placeholder:"Subject name",type:"text",className:"border rounded p-2 w-full bg-white dark:bg-gray-700",value:c.subjectName,onChange:a=>S("subjectName",a.target.value),required:!0}),e.jsx("input",{placeholder:"Date",type:"date",className:"border rounded p-2 w-full bg-white dark:bg-gray-700",value:c.date,onChange:a=>S("date",a.target.value),required:!0}),e.jsx("input",{placeholder:"Time",type:"time",className:"border rounded p-2 w-full bg-white dark:bg-gray-700",value:c.time,onChange:a=>S("time",a.target.value),required:!0}),(p==null?void 0:p.length)>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Manual Teacher Selection"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded p-2",children:p.map(a=>e.jsxs("label",{className:"flex items-center gap-2 p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx("input",{type:"checkbox",value:a.id,checked:D.includes(a.id),onChange:t=>{const s=a.id;t.target.checked?P(d=>[...d,s]):P(d=>d.filter(n=>n!==s))}}),e.jsxs("span",{children:[a.name," ",a.email?`(${a.email})`:""]})]},a.id))})]}),(m==null?void 0:m.rooms)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block font-semibold mb-2",children:"Manual Room Selection (optional override)"}),e.jsx("div",{className:"max-h-36 overflow-y-auto border rounded p-2",children:m.rooms.map(a=>e.jsxs("label",{className:"flex items-center gap-2 p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:[e.jsx("input",{type:"checkbox",value:a.id,checked:U.includes(a.id),onChange:t=>{const s=a.id;t.target.checked?k(d=>[...d,s]):k(d=>d.filter(n=>n!==s))}}),e.jsxs("span",{children:[a.room_name," (Capacity: ",a.room_type,")"]})]},a.id))})]})]}),u.length>0&&e.jsx("div",{className:"mt-6 max-h-72 overflow-auto border rounded",children:e.jsxs("table",{className:"min-w-full table-auto border-collapse border border-gray-300 dark:border-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-left",children:"Student"}),e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-left",children:"Teacher"}),e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-left",children:"Batch"}),e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-left",children:"College"}),e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-left",children:"Subject"}),e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-left",children:"Date"}),e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-left",children:"Time"}),e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-left",children:"Room"}),e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:u.map((a,t)=>{var s,d,n,r;return e.jsx("tr",{className:t%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-700",children:K===t?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:e.jsx("input",{type:"text",value:f.student_name,onChange:l=>I("student_name",l.target.value),className:"w-full border rounded px-1 py-0.5"})}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:e.jsx("input",{type:"text",value:f.teacher_name,onChange:l=>I("teacher_name",l.target.value),className:"w-full border rounded px-1 py-0.5"})}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.class_name}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.college_name}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.subject_name}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:e.jsx("input",{type:"date",value:f.date,onChange:l=>I("date",l.target.value),className:"w-full border rounded px-1 py-0.5"})}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:e.jsx("input",{type:"time",value:f.time,onChange:l=>I("time",l.target.value),className:"w-full border rounded px-1 py-0.5"})}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:e.jsx("input",{type:"text",value:((d=(s=m.rooms)==null?void 0:s.find(l=>l.id===f.room_id))==null?void 0:d.room_name)||"",onChange:l=>{},className:"w-full border rounded px-1 py-0.5",disabled:!0})}),e.jsxs("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-center whitespace-nowrap",children:[e.jsx("button",{className:"text-green-600 hover:text-green-800 px-2",onClick:()=>oe(t),children:"Save"}),e.jsx("button",{className:"text-red-600 hover:text-red-800 px-2",onClick:V,children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.student_name}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.teacher_name}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.class_name}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.college_name}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.subject_name}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.date}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:a.time}),e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1",children:((r=(n=m.rooms)==null?void 0:n.find(l=>l.id===a.room_id))==null?void 0:r.room_name)||"N/A"}),e.jsxs("td",{className:"border border-gray-300 dark:border-gray-600 px-2 py-1 text-center whitespace-nowrap",children:[e.jsx("button",{className:"text-indigo-600 hover:text-indigo-800 px-2",onClick:()=>ne(t),children:"Edit"}),e.jsx("button",{className:"text-red-600 hover:text-red-800 px-2",onClick:()=>ie(t),children:"Delete"})]})]})},t)})})]})}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{type:"button",onClick:le,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",disabled:_,children:"Preview"}),e.jsx("button",{type:"button",onClick:ce,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",disabled:_,children:"Add Single Mapping"}),e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700",disabled:_||u.length===0,children:_?"Saving...":"Create Admin Card"})]})]})]})})]})]})}ye.layout=B=>e.jsx(ue,{children:B});export{ye as default};
