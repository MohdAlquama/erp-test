import{r as i,j as e,S as A}from"./app-Da_nhggM.js";import{A as I}from"./AdminLayout-BFQKyw_n.js";import{u as E}from"./adminContext-CI6wc_Go.js";import{a as n}from"./axiosInstance-BO4ZrsK3.js";import{V as c}from"./index-CgiR4QPD.js";import{L as F}from"./Loader-DsengPFF.js";import{P as $}from"./plus-Ch-b2fYz.js";import{T as V}from"./trash-2-D4oQZmeE.js";import{E as P}from"./eye-FoJeu7DB.js";import"./menu-By4tiiDw.js";import"./createLucideIcon-Cl5mBFKr.js";import"./search-Cy0dovnH.js";import"./bell-Dmhy7b3m.js";import"./user-C3Ls9d9N.js";import"./x-Buk7JkW1.js";import"./house-BqJmp5lC.js";import"./users-SPycqOBZ.js";import"./graduation-cap-C0ne5fPE.js";import"./file-text-DJmdbdJJ.js";import"./settings-2yKiBYT4.js";import"./log-out-C0sdDckr.js";import"./loader-circle-BW8mmFDU.js";function R({folder:s}){const{admin:a}=E(),[b,j]=i.useState([]),[w,p]=i.useState([]),[N,k]=i.useState([]),[o,g]=i.useState(""),[h,m]=i.useState(!1),[x,l]=i.useState(!1),[f,y]=i.useState(null),u=async()=>{if(!(!(a!=null&&a.id)||!(s!=null&&s.id)))try{l(!0);const r=(await n.get("admin/admin-folder-data",{params:{admin_id:a.id,folder_id:s.id}})).data.data;j(r);const d=[...new Set(r.map(L=>L.batch_id))];if(d.length===0){p([]);return}const D=await n.post("/admin/get-batches-by-ids",{batch_ids:d});p(D.data.batches||[])}catch{c.error("Failed to load linked batches.")}finally{l(!1)}},S=async()=>{if(a!=null&&a.id)try{l(!0);const t=await n.get(`/admin/${a.id}/AdminGetBatch`);k(t.data.batches||[])}catch{c.error("Failed to load batches.")}finally{l(!1)}};i.useEffect(()=>{u()},[a==null?void 0:a.id,s==null?void 0:s.id]),i.useEffect(()=>{h&&S()},[h]);const v=t=>{g(t.target.value)},B=async()=>{if(!o){c.error("Please select a batch.");return}try{l(!0),await n.post("/admin/save-batch-folder",{admin_id:a.id,batch_id:o,folder_id:s==null?void 0:s.id}),c.success("Batch linked to folder successfully!"),m(!1),g(""),await u()}catch{c.error("Failed to save batch-folder link.")}finally{l(!1)}},_=async t=>{if(window.confirm("Are you sure you want to unlink this batch from the folder?"))try{y(t),await n.delete(`/admin/delete-batch-folder/${t}`,{params:{admin_id:a.id}}),c.success("Batch-folder link deleted successfully!"),await u()}catch{c.error("Failed to delete batch-folder link.")}finally{y(null)}},C=t=>{const r=btoa(t.toString()),d=btoa(s.id.toString());A.visit(`/admin/getIenertiaParamShowOfSubject/${r}/${d}/${a.id}`)};return e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-900 min-h-screen text-gray-900 dark:text-white relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Batches Linked to Folder"}),e.jsxs("button",{onClick:()=>m(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"})," Select Batch"]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-800 dark:text-white",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Batch Name"}),e.jsx("th",{className:"px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:x?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"px-4 py-4 text-center",children:e.jsx(F,{message:"Loading batches..."})})}):b.length>0?b.map(t=>{const r=w.find(d=>d.id===t.batch_id);return e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("td",{className:"px-4 py-2",children:r?r.name:"Batch not found"}),e.jsx("td",{className:"px-4 py-2",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>_(t.id),disabled:f===t.id,className:"text-red-600 hover:text-red-800 flex items-center gap-1 mr-4",title:"Delete Link",children:[e.jsx(V,{className:"w-4 h-4"}),f===t.id?"Deleting...":"Delete"]}),e.jsxs("button",{onClick:()=>C(r.id),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"View Batch",children:[e.jsx(P,{className:"w-4 h-4"}),"View"]})]}):e.jsx("span",{className:"text-gray-500",children:"No actions"})})]},t.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"px-4 py-4 text-center text-gray-500 dark:text-gray-400",children:"No batches linked to this folder."})})})]})}),e.jsxs("div",{className:`fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white dark:bg-gray-900 shadow-xl transition-transform duration-300 z-50 ${h?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 dark:text-white",children:"Select Batch"}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-600 dark:text-gray-300 hover:text-red-600",children:"âœ•"})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Choose a Batch"}),e.jsxs("select",{value:o,onChange:v,className:"w-full px-4 py-2 border rounded dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"-- Select Batch --"}),N.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("button",{onClick:B,disabled:x,className:"bg-indigo-600 text-white w-full py-2 rounded hover:bg-indigo-700",children:x?"Saving...":"Save Selection"})]})]})]})}R.layout=s=>e.jsx(I,{children:s});export{R as default};
