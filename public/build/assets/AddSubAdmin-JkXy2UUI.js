import{r as p,j as e,a as C}from"./app-Da_nhggM.js";import{V as l}from"./index-CgiR4QPD.js";import{S as $}from"./SupperAdminLayout-DRT6nf7T.js";import{c as L}from"./createLucideIcon-Cl5mBFKr.js";import{E as I}from"./eye-FoJeu7DB.js";import{P as z}from"./plus-Ch-b2fYz.js";import{P as B}from"./pencil-BsWPgLZ3.js";import{T as M}from"./trash-2-D4oQZmeE.js";import{m as X}from"./proxy-C-WlPmFb.js";import"./search-Cy0dovnH.js";import"./bell-Dmhy7b3m.js";import"./settings-2yKiBYT4.js";import"./clsx-B-dksMZM.js";import"./x-Buk7JkW1.js";import"./layout-dashboard-DeJPl4RO.js";import"./log-out-C0sdDckr.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],R=L("eye-off",Q);function V({onSubmit:k,permissionsData:b,initialData:o=null}){const[v,E]=p.useState(!1),[S,j]=p.useState(!1),[x,w]=p.useState({name:"",email:"",password:"",confirmPassword:"",phone:"",dob:"",ip:"",status:"active",address:"",role:""}),[N,A]=p.useState([]),y=!!o;p.useEffect(()=>{o&&(w({name:o.name||"",email:o.email||"",password:"",confirmPassword:"",phone:o.phone||"",dob:o.dob||"",ip:o.ip||"",status:o.status||"active",address:o.address||"",role:o.role||""}),A(typeof o.permissions=="string"&&o.permissions?o.permissions.split(".").filter(Boolean):Array.isArray(o.permissions)?o.permissions:[]))},[o]);const i=t=>{const{name:r,value:h}=t.target;w(f=>({...f,[r]:h})),r==="role"&&A([])},P=t=>{if(!/^[a-zA-Z]+$/.test(t)){l.error(`Invalid permission: ${t}. Only alphanumeric characters are allowed.`);return}A(r=>r.includes(t)?r.filter(h=>h!==t):[...r,t])},F=async t=>{t.preventDefault();const r={...x,permissions:N.length>0?"."+N.join("."):null};if(!r.name||!r.email||!r.role||!r.status){l.error("Please fill all required fields!");return}const h=r.password||r.confirmPassword;if(!y&&(!r.password||!r.confirmPassword)){l.error("Password is required!");return}if(h&&r.password!==r.confirmPassword){l.error("Passwords do not match!");return}if(r.permissions&&!/^(\.[a-zA-Z]+)*$/.test(r.permissions)){l.error("Permissions format is invalid. Use only alphanumeric characters.");return}h||(delete r.password,delete r.confirmPassword);try{await k(r)}catch(f){console.error("Submission error:",f),l.error("Failed to submit form. Check console for details.")}};return e.jsxs("form",{className:"p-4 space-y-4",onSubmit:F,children:[[{label:"Name",name:"name",type:"text",placeholder:"Enter full name"},{label:"Email",name:"email",type:"email",placeholder:"Enter email address"},{label:"Phone Number",name:"phone",type:"tel",placeholder:"Enter phone number"},{label:"Date of Birth",name:"dob",type:"date"},{label:"IP Address",name:"ip",type:"text",placeholder:"Enter IP address"}].map(({label:t,name:r,type:h,placeholder:f})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t}),e.jsx("input",{name:r,type:h,placeholder:f,value:x[r],onChange:i,className:"mt-1 w-full px-3 py-2 rounded border dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]},r)),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status"}),e.jsxs("select",{name:"status",value:x.status,onChange:i,className:"mt-1 w-full px-3 py-2 rounded border dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:y?"Password (optional)":"Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{name:"password",type:v?"text":"password",placeholder:y?"Enter new password":"Enter password",value:x.password,onChange:i,className:"w-full px-3 py-2 rounded border dark:bg-gray-800 dark:border-gray-600 dark:text-white pr-10"}),e.jsx("button",{type:"button",onClick:()=>E(!v),className:"absolute top-1/2 right-3 transform -translate-y-1/2 text-gray-500 dark:text-gray-300",children:v?e.jsx(R,{className:"w-5 h-5"}):e.jsx(I,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:y?"Confirm Password (optional)":"Confirm Password"}),e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{name:"confirmPassword",type:S?"text":"password",placeholder:y?"Confirm new password":"Confirm password",value:x.confirmPassword,onChange:i,className:"w-full px-3 py-2 rounded border dark:bg-gray-800 dark:border-gray-600 dark:text-white pr-10"}),e.jsx("button",{type:"button",onClick:()=>j(!S),className:"absolute top-1/2 right-3 transform -translate-y-1/2 text-gray-500 dark:text-gray-300",children:S?e.jsx(R,{className:"w-5 h-5"}):e.jsx(I,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role"}),e.jsxs("select",{name:"role",value:x.role,onChange:i,className:"mt-1 w-full px-3 py-2 rounded border dark:bg-gray-800 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Select role"}),b.map(t=>e.jsx("option",{value:t.feature,children:t.feature},t.feature))]})]}),x.role&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:["Assign Permissions for ",e.jsx("span",{className:"capitalize",children:x.role}),":"]}),b.filter(t=>t.feature===x.role).map(t=>e.jsx("div",{className:"mb-3 max-h-64 overflow-y-auto pr-2",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:t.permissions.map(r=>e.jsxs("label",{className:"flex items-start gap-2 text-sm text-gray-700 dark:text-gray-200 break-all",children:[e.jsx("input",{type:"checkbox",value:r,checked:N.includes(r),onChange:()=>P(r),className:"mt-1"}),e.jsx("span",{className:"break-all ",title:r,children:r})]},r))})},t.feature))]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Residential Address"}),e.jsx("textarea",{name:"address",value:x.address,onChange:i,placeholder:"Enter residential address",rows:"3",className:"mt-1 w-full px-3 py-2 rounded border dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded shadow",children:"Submit"})]})}function le(){const[k,b]=p.useState(!1),[o,v]=p.useState([]),[E,S]=p.useState(""),[j,x]=p.useState("name"),[w,N]=p.useState("asc"),[A,y]=p.useState([]),[i,P]=p.useState(null);p.useEffect(()=>{F(),t()},[]);const F=async()=>{var s;try{const a=await C.get("/supper/permission-list",{headers:{"X-CSRF-TOKEN":(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content}});console.log("Permissions data:",a.data),y(a.data)}catch(a){l.error("Failed to load permissions"),console.error("Permission fetch error:",a)}},t=async()=>{var s;try{const a=await C.get("/supper/fetch-subadmin",{headers:{"X-CSRF-TOKEN":(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.content}});console.log("Fetched sub-admins:",a.data.data),v(a.data.data)}catch(a){l.error("Failed to load Sub-Admins"),console.error("Sub-admins fetch error:",a)}},r=async s=>{var a,c,m,d,u,g;try{console.log("Sending add sub-admin request:",s);const n=await C.post("/supper/add-subadmin",s,{headers:{"X-CSRF-TOKEN":(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content}});l.success("Sub-Admin added!"),t(),b(!1)}catch(n){console.error("Add sub-admin error:",((c=n.response)==null?void 0:c.data)||n.message),(d=(m=n.response)==null?void 0:m.data)!=null&&d.errors?Object.values(n.response.data.errors).forEach(U=>l.error(U[0])):l.error("Error adding sub-admin: "+(((g=(u=n.response)==null?void 0:u.data)==null?void 0:g.error)||n.message))}},h=async s=>{var a,c,m,d,u,g;if(!(i!=null&&i.id)){l.error("No sub-admin ID provided for update!"),console.error("Missing editingAdmin.id",{editingAdmin:i});return}console.log("Updating admin with ID:",i.id,"Data:",s);try{const n=await C.put(`/supper/update-subadmin/${i.id}`,s,{headers:{"X-CSRF-TOKEN":(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content}});l.success("Sub-Admin updated!"),t(),b(!1),P(null)}catch(n){console.error("Update error:",((c=n.response)==null?void 0:c.data)||n.message),(d=(m=n.response)==null?void 0:m.data)!=null&&d.errors?Object.values(n.response.data.errors).forEach(U=>l.error(U[0])):l.error(`Failed to update sub-admin: ${((g=(u=n.response)==null?void 0:u.data)==null?void 0:g.error)||n.message}`)}},f=async s=>{var a,c,m;if(window.confirm("Are you sure you want to delete this sub-admin?"))try{await C.delete(`/supper/delete-subadmin/${s}`,{headers:{"X-CSRF-TOKEN":(a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.content}}),l.success("Sub-Admin deleted!"),t()}catch(d){l.error("Failed to delete sub-admin: "+(((m=(c=d.response)==null?void 0:c.data)==null?void 0:m.error)||d.message)),console.error("Delete error:",d)}},T=s=>{console.log("Editing admin:",s),P(s),b(!0)},O=()=>{b(!k),k&&P(null)},K=s=>{j===s?N(a=>a==="asc"?"desc":"asc"):(x(s),N("asc"))},q=[...o].filter(s=>[s.name,s.email,s.phone,s.role].some(a=>a==null?void 0:a.toLowerCase().includes(E.toLowerCase()))).sort((s,a)=>{var d,u,g,n;const c=((u=(d=s[j])==null?void 0:d.toLowerCase)==null?void 0:u.call(d))||"",m=((n=(g=a[j])==null?void 0:g.toLowerCase)==null?void 0:n.call(g))||"";return c<m?w==="asc"?-1:1:c>m?w==="asc"?1:-1:0});return e.jsx($,{children:e.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-950 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Sub-Admins"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Search...",value:E,onChange:s=>S(s.target.value),className:"px-4 py-2 rounded border dark:bg-gray-900 dark:border-gray-700 dark:text-white"}),e.jsxs("button",{onClick:O,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow",children:[e.jsx(z,{className:"w-4 h-4"}),"Add User"]})]})]}),q.length>0?e.jsx("div",{className:"overflow-auto rounded-lg shadow border dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"#"}),e.jsx("th",{className:"px-4 py-2",children:"Avatar"}),["name","email","phone","dob","ip","address","role","permissions","modules"].map(s=>e.jsxs("th",{onClick:()=>K(s),className:"px-4 py-2 cursor-pointer",children:[s.charAt(0).toUpperCase()+s.slice(1)," ",j===s&&(w==="asc"?"▲":"▼")]},s)),e.jsx("th",{className:"px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-900",children:q.map((s,a)=>{var c,m;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:a+1}),e.jsx("td",{className:"px-4 py-2",children:s.avatar?e.jsx("img",{src:s.avatar,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-white",children:((m=(c=s.name)==null?void 0:c[0])==null?void 0:m.toUpperCase())||"?"})}),e.jsx("td",{className:"px-4 py-2",children:s.name}),e.jsx("td",{className:"px-4 py-2",children:s.email}),e.jsx("td",{className:"px-4 py-2",children:s.phone||"N/A"}),e.jsx("td",{className:"px-4 py-2",children:s.dob||"N/A"}),e.jsx("td",{className:"px-4 py-2",children:s.ip||"N/A"}),e.jsx("td",{className:"px-4 py-2",children:s.address||"N/A"}),e.jsx("td",{className:"px-4 py-2",children:s.role||"N/A"}),e.jsx("td",{className:"px-4 py-2",children:typeof s.permissions=="string"&&s.permissions?s.permissions:Array.isArray(s.permissions)&&s.permissions.length>0?s.permissions.join(", "):e.jsx("span",{className:"text-gray-400 italic",children:"No Permissions"})}),e.jsx("td",{className:"px-4 py-2",children:typeof s.permissions=="string"&&s.permissions?s.permissions.split(".").filter(Boolean).map((d,u)=>e.jsx("span",{className:"inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-1 dark:bg-green-900 dark:text-green-100",children:d},u)):Array.isArray(s.permissions)&&s.permissions.length>0?s.permissions.map((d,u)=>e.jsx("span",{className:"inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-1 dark:bg-green-900 dark:text-green-100",children:d},u)):e.jsx("span",{className:"text-gray-400 italic",children:"N/A"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`inline-block px-2 py-1 text-xs rounded-full ${s.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200"}`,children:s.status==="active"?"Active":"Inactive"})}),e.jsxs("td",{className:"px-4 py-2 space-x-2",children:[e.jsx("button",{onClick:()=>T(s),className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx(B,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>f(s.id),className:"text-red-600 hover:text-red-800",title:"Delete",children:e.jsx(M,{className:"w-4 h-4"})})]})]},s.id)})})]})}):e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"No sub-admins found."}),k&&e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:O,className:"fixed inset-0 bg-black/40 z-40"}),e.jsxs(X.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{duration:.3},className:"fixed top-0 right-0 w-full sm:w-[450px] h-full bg-white dark:bg-gray-900 shadow-lg z-50 overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:i?"Edit Sub-Admin":"Add Sub-Admin"}),e.jsx("button",{onClick:O,className:"text-gray-600 dark:text-gray-300 hover:text-red-500",children:"✕"})]}),e.jsx(V,{onSubmit:i?h:r,initialData:i,permissionsData:A})]})]})]})})}export{le as default};
