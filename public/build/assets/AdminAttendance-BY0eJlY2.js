import{r as b,j as e}from"./app-DVKDYkXn.js";import{a as p}from"./axiosInstance-DbG8c_Wf.js";function S({adminId:x}){const[d,c]=b.useState([]),[a,l]=b.useState({batchSubject:[],monthly:[],yearly:[],today:[]}),[i,r]=b.useState(new Date().getFullYear()),y=async()=>{try{const s=await p.get(`/admin/${x}/attendance`);c(s.data),l(u(s.data))}catch(s){console.error("Error fetching attendance",s)}};b.useEffect(()=>{y()},[]),b.useEffect(()=>{if(a.yearly.length>0){const s=new Date().getFullYear(),t=a.yearly.map(o=>o.year);t.includes(s)?r(s):r(t[0])}},[a.yearly]);const h=a.monthly.filter(s=>s.month.startsWith(i.toString()));return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Today's Attendance"}),a.today.length>0?e.jsxs("table",{className:"w-full border text-left",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Batch"}),e.jsx("th",{className:"p-2 border",children:"Subject"}),e.jsx("th",{className:"p-2 border",children:"Present"}),e.jsx("th",{className:"p-2 border",children:"Absent"})]})}),e.jsx("tbody",{children:a.today.map((s,t)=>e.jsxs("tr",{className:"border",children:[e.jsx("td",{className:"p-2 border",children:s.batch}),e.jsx("td",{className:"p-2 border",children:s.subject}),e.jsx("td",{className:"p-2 border",children:s.present}),e.jsx("td",{className:"p-2 border",children:s.absent})]},t))})]}):e.jsx("p",{className:"text-gray-500",children:"No attendance data for today."})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Batch + Subject Summary"}),e.jsxs("table",{className:"w-full border text-left",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Batch"}),e.jsx("th",{className:"p-2 border",children:"Subject"}),e.jsx("th",{className:"p-2 border",children:"Present"}),e.jsx("th",{className:"p-2 border",children:"Absent"})]})}),e.jsx("tbody",{children:a.batchSubject.map((s,t)=>e.jsxs("tr",{className:"border",children:[e.jsx("td",{className:"p-2 border",children:s.batch}),e.jsx("td",{className:"p-2 border",children:s.subject}),e.jsx("td",{className:"p-2 border",children:s.present}),e.jsx("td",{className:"p-2 border",children:s.absent})]},t))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Monthly Summary"}),e.jsx("select",{value:i,onChange:s=>r(Number(s.target.value)),className:"border rounded p-1",children:a.yearly.sort((s,t)=>t.year-s.year).map((s,t)=>e.jsx("option",{value:s.year,children:s.year},t))})]}),e.jsxs("table",{className:"w-full border text-left",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Month"}),e.jsx("th",{className:"p-2 border",children:"Present"}),e.jsx("th",{className:"p-2 border",children:"Absent"})]})}),e.jsx("tbody",{children:h.map((s,t)=>e.jsxs("tr",{className:"border",children:[e.jsx("td",{className:"p-2 border",children:s.month}),e.jsx("td",{className:"p-2 border",children:s.present}),e.jsx("td",{className:"p-2 border",children:s.absent})]},t))})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Yearly Summary"}),e.jsxs("table",{className:"w-full border text-left",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Year"}),e.jsx("th",{className:"p-2 border",children:"Present"}),e.jsx("th",{className:"p-2 border",children:"Absent"})]})}),e.jsx("tbody",{children:a.yearly.map((s,t)=>e.jsxs("tr",{className:"border",children:[e.jsx("td",{className:"p-2 border",children:s.year}),e.jsx("td",{className:"p-2 border",children:s.present}),e.jsx("td",{className:"p-2 border",children:s.absent})]},t))})]})]})]})}function u(x){const d={},c={},a={},l={},i=new Date().toISOString().slice(0,10);x.forEach(y=>{const{batch_name:h,subject_name:s,status:t,date:o}=y,n=`${h}-${s}`;d[n]||(d[n]={batch:h,subject:s,present:0,absent:0}),d[n][t]+=1;const m=o.slice(0,7);c[m]||(c[m]={month:m,present:0,absent:0}),c[m][t]+=1;const j=o.slice(0,4);a[j]||(a[j]={year:Number(j),present:0,absent:0}),a[j][t]+=1,o===i&&(l[n]||(l[n]={batch:h,subject:s,present:0,absent:0}),l[n][t]+=1)});const r=new Date().getFullYear();return a[r]||(a[r]={year:r,present:0,absent:0}),{batchSubject:Object.values(d),monthly:Object.values(c),yearly:Object.values(a),today:Object.values(l)}}export{S as default};
