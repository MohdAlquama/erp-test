import{r as d,j as e}from"./app-Da_nhggM.js";import{u as I,T}from"./TeacherLayout-DqvGaxB6.js";import{a as h}from"./axiosInstance-BO4ZrsK3.js";import{V as o,O as W}from"./index-CgiR4QPD.js";import z from"./CheckAttendance-XScpOm7n.js";import"./user-C3Ls9d9N.js";import"./createLucideIcon-Cl5mBFKr.js";import"./x-Buk7JkW1.js";import"./house-BqJmp5lC.js";import"./settings-2yKiBYT4.js";import"./log-out-C0sdDckr.js";import"./menu-By4tiiDw.js";import"./bell-Dmhy7b3m.js";function H(){const{teacherData:s}=I(),[p,v]=d.useState([]),[c,_]=d.useState(""),[m,f]=d.useState([]),[n,j]=d.useState(""),[x,S]=d.useState(new Date().toISOString().split("T")[0]),[k,y]=d.useState(!1),[g,b]=d.useState([]),[u,N]=d.useState(!1),[C,A]=d.useState(0);d.useEffect(()=>{s!=null&&s.admin_id&&h.get(`/teacher/admin/${s.admin_id}/batches`).then(t=>{if(t.data.success){let a=[];s!=null&&s.batch_ids&&(Array.isArray(s.batch_ids)?a=s.batch_ids.map(i=>parseInt(i)):typeof s.batch_ids=="string"?a=s.batch_ids.split(",").map(i=>parseInt(i)):a=[parseInt(s.batch_ids)]);const r=t.data.data.filter(i=>a.includes(i.id));v(r)}}).catch(t=>{o.error("Error fetching batches"),console.error(t)})},[s]),d.useEffect(()=>{!c||!(s!=null&&s.id)||(y(!0),f([]),j(""),h.post("/teacher/subjects",{admin_id:s.admin_id,batch_id:c,teacher_id:s.id}).then(t=>{t.data.success?f(t.data.data):o.error("No subjects found")}).catch(t=>{o.error("Error fetching subjects"),console.error(t)}).finally(()=>y(!1)))},[c,s]);const B=()=>{if(!c||!n||!x){o.error("Please select batch, subject, and date");return}N(!0),b([]),h.post("/teacher/subject/details",{admin_id:s.admin_id,teacher_id:s.id,subject_id:n,batch_id:c}).then(t=>{if(t.data.success){const a=t.data.data.map(r=>({...r,status:"present"}));b(a)}else o.error("No students found")}).catch(t=>{o.error("Error fetching student details"),console.error(t)}).finally(()=>N(!1))},w=(t,a)=>{const r=[...g];r[t].status=a,b(r)},E=t=>{var r,i;const a={teacher_name:s.name,subject_name:((r=m.find(l=>l.id==n))==null?void 0:r.subject)||"",subject_id:n,batch_name:((i=p.find(l=>l.id==c))==null?void 0:i.name)||"",batch_id:c,date:x,student_name:t.student_name,student_enrollment_number:t.enrollment_number,status:t.status,teacher_id:s.id,admin_id:s.admin_id};h.post("/teacher/attendance",a).then(l=>{l.data.success&&(o.success("Attendance saved!"),A(L=>L+1))}).catch(l=>{o.error("Error saving attendance"),console.error(l)})};return e.jsxs("div",{className:"container mx-auto p-4 sm:p-6 bg-gray-50 min-h-screen",children:[e.jsx(W,{position:"top-right"}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-6",children:"Take Attendance"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Batch"}),e.jsxs("select",{className:"w-full sm:w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",value:c,onChange:t=>_(t.target.value),children:[e.jsx("option",{value:"",children:"-- Choose a Batch --"}),p.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),c&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Subject"}),k?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),e.jsx("p",{className:"text-gray-500",children:"Loading subjects..."})]}):m.length>0?e.jsxs("select",{className:"w-full sm:w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",value:n,onChange:t=>j(t.target.value),children:[e.jsx("option",{value:"",children:"-- Choose a Subject --"}),m.map(t=>e.jsx("option",{value:t.id,children:t.subject},t.id))]}):e.jsx("p",{className:"text-red-500 text-sm",children:"No subjects found for this batch"})]}),c&&n&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Date"}),e.jsx("input",{type:"date",className:"w-full sm:w-1/2 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",value:x,onChange:t=>S(t.target.value)})]}),c&&n&&e.jsx("button",{onClick:B,className:"w-full sm:w-auto bg-blue-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-blue-700 transition disabled:bg-blue-400",disabled:u,children:u?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 mr-2 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"Loading..."]}):"Load Students"}),e.jsx("div",{className:"mt-8",children:u?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),e.jsx("p",{className:"text-gray-500",children:"Loading students..."})]}):g.length>0?e.jsx("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Teacher"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Subject"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Batch"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Student"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Enrollment"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:g.map((t,a)=>{var r,i;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:(r=m.find(l=>l.id==n))==null?void 0:r.subject}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:(i=p.find(l=>l.id==c))==null?void 0:i.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:x}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.student_name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.enrollment_number}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:`status-${a}`,checked:t.status==="present",onChange:()=>w(a,"present"),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Present"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",name:`status-${a}`,checked:t.status==="absent",onChange:()=>w(a,"absent"),className:"text-blue-600 focus:ring-blue-500"}),e.jsx("span",{children:"Absent"})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>E(t),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition",children:"Log"})})]},a)})})]})}):c&&n&&!u&&e.jsx("p",{className:"text-red-500 text-sm",children:"No students found"})}),c&&n&&e.jsx(z,{teacher_id:s.id,batch_id:c,subject_id:n,date:x,reload:C})]})}H.layout=s=>e.jsx(T,{children:s});export{H as default};
