import{r as s,j as e,S as A}from"./app-Da_nhggM.js";import{A as D}from"./AdminLayout-BFQKyw_n.js";import{V as a}from"./index-CgiR4QPD.js";import{u as L}from"./adminContext-CI6wc_Go.js";import{a as o}from"./axiosInstance-BO4ZrsK3.js";import{L as M}from"./Loader-DsengPFF.js";import{P as F}from"./plus-Ch-b2fYz.js";import{V}from"./view-B1lS9SFf.js";import{P as $}from"./pencil-BsWPgLZ3.js";import{T as P}from"./trash-uQxS6n-9.js";import"./menu-By4tiiDw.js";import"./createLucideIcon-Cl5mBFKr.js";import"./search-Cy0dovnH.js";import"./bell-Dmhy7b3m.js";import"./user-C3Ls9d9N.js";import"./x-Buk7JkW1.js";import"./house-BqJmp5lC.js";import"./users-SPycqOBZ.js";import"./graduation-cap-C0ne5fPE.js";import"./file-text-DJmdbdJJ.js";import"./settings-2yKiBYT4.js";import"./log-out-C0sdDckr.js";import"./loader-circle-BW8mmFDU.js";function I(){const{permissions:n,admin:l}=L(),[j,w]=s.useState([]),[r,m]=s.useState({name:"",grade:"",section:""}),[i,u]=s.useState(null),[N,c]=s.useState(!1),[p,v]=s.useState(""),[k,g]=s.useState(!0),d=t=>n==null?void 0:n.includes(t);s.useEffect(()=>{h()},[]);const h=async()=>{g(!0);try{const t=await o.get(`/admin/${l.id}/batches`);w(t.data)}catch{a.error("Failed to fetch batches")}finally{g(!1)}},x=t=>{m({...r,[t.target.name]:t.target.value})},y=()=>{m({name:"",grade:"",section:""}),u(null)},S=async t=>{if(t.preventDefault(),!d(i!==null?"StudentManagementBatchEdit":"StudentManagementBatchAdd"))return a.error("You do not have permission.");if(!r.name.trim())return a.error("Batch name is required");const f={...r,created_by:l==null?void 0:l.id};try{i!==null?(await o.put(`/admin/batches/${i}`,f),a.success("Batch updated")):(await o.post("/admin/batches",f),a.success("Batch added")),h(),y(),c(!1)}catch{a.error("Something went wrong")}},B=t=>{m({name:t.name,grade:t.grade,section:t.section}),u(t.id),c(!0)},C=async t=>{if(!d("StudentManagementBatchDelete"))return a.error("You do not have permission.");if(window.confirm("Are you sure to delete this batch?"))try{await o.delete(`/admin/batches/${t}`),a.success("Batch deleted"),h()}catch{a.error("Failed to delete")}},E=t=>{A.get(`/admin/batches/${t}`)},b=j.filter(t=>t.name.toLowerCase().includes(p.toLowerCase()));return e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-900 min-h-screen text-gray-900 dark:text-white relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Batches"}),d("StudentManagementBatchAdd")&&e.jsxs("button",{onClick:()=>c(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"})," Add Batch"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search by batch name",value:p,onChange:t=>v(t.target.value),className:"px-4 py-2 border rounded w-full md:w-1/3 dark:bg-gray-800 dark:text-white"})}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow",children:k?e.jsx("div",{className:"p-6 flex justify-center",children:e.jsx(M,{message:"Fetching batches..."})}):e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-800 dark:text-white",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Name"}),e.jsx("th",{className:"px-4 py-2",children:"Grade"}),e.jsx("th",{className:"px-4 py-2",children:"Section"}),e.jsx("th",{className:"px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:b.length>0?b.map(t=>e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("td",{className:"px-4 py-2",children:t.name}),e.jsx("td",{className:"px-4 py-2",children:t.grade}),e.jsx("td",{className:"px-4 py-2",children:t.section}),e.jsxs("td",{className:"px-4 py-2 flex gap-2",children:[e.jsxs("button",{onClick:()=>E(t.id),className:"text-yellow-600 hover:underline",children:[e.jsx(V,{className:"w-4 h-4 inline"})," view"]}),d("StudentManagementBatchEdit")&&e.jsxs("button",{onClick:()=>B(t),className:"text-yellow-600 hover:underline",children:[e.jsx($,{className:"w-4 h-4 inline"})," Edit"]}),d("StudentManagementBatchDelete")&&e.jsxs("button",{onClick:()=>C(t.id),className:"text-red-600 hover:underline",children:[e.jsx(P,{className:"w-4 h-4 inline"})," Delete"]})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-4 py-4 text-center text-gray-500 dark:text-gray-400",children:"No batches found."})})})]})}),e.jsxs("div",{className:`fixed top-0 right-0 h-full w-full sm:w-[400px] bg-white dark:bg-gray-900 shadow-xl transition-transform duration-300 z-50 ${N?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 dark:text-white",children:i!==null?"Edit Batch":"Add Batch"}),e.jsx("button",{onClick:()=>{c(!1),y()},className:"text-gray-600 dark:text-gray-300 hover:text-red-600",children:"âœ•"})]}),e.jsxs("form",{onSubmit:S,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Batch Name"}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:x,required:!0,className:"w-full px-4 py-2 border rounded dark:bg-gray-800 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Grade"}),e.jsx("input",{type:"text",name:"grade",value:r.grade,onChange:x,className:"w-full px-4 py-2 border rounded dark:bg-gray-800 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Section"}),e.jsx("input",{type:"text",name:"section",value:r.section,onChange:x,className:"w-full px-4 py-2 border rounded dark:bg-gray-800 dark:text-white"})]}),e.jsx("button",{type:"submit",className:"bg-indigo-600 text-white w-full py-2 rounded hover:bg-indigo-700",children:i!==null?"Update Batch":"Create Batch"})]})]})]})}I.layout=n=>e.jsx(D,{children:n});export{I as default};
