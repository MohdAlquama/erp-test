import{b as W,r as c,j as e}from"./app-DVKDYkXn.js";import{S as U}from"./SupperAdminLayout-lTWtW5b5.js";import{V as l,O as $}from"./index-Cz5qM-jY.js";import{a as x}from"./axiosInstance-DbG8c_Wf.js";import{P as M}from"./plus-DVonVEYX.js";import{P as z}from"./pencil-9aROhUc8.js";import{T as V}from"./trash-2-DbrrDeOm.js";import"./createLucideIcon-V0M9PHiF.js";import"./search-CWxSpjiP.js";import"./bell-BPh2_WIZ.js";import"./settings-DfQ06Dqm.js";import"./clsx-B-dksMZM.js";import"./x-BXpkOE8a.js";import"./layout-dashboard-z_EU-noV.js";import"./log-out-mnJCr85j.js";var T={exports:{}},v,A;function G(){if(A)return v;A=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return v=i,v}var _,R;function B(){if(R)return _;R=1;var i=G();function m(){}function p(){}return p.resetWarningCache=m,_=function(){function s(S,b,j,k,n,u){if(u!==i){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}s.isRequired=s;function a(){return s}var h={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:a,element:s,elementType:s,instanceOf:a,node:s,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:p,resetWarningCache:m};return h.PropTypes=h,h},_}var C;function H(){return C||(C=1,T.exports=B()()),T.exports}var Y=H();const E=W(Y);function P({initialTokens:i=[],subAdmins:m=[]}){const[p,s]=c.useState(i),[a,h]=c.useState(m),[S,b]=c.useState(!1),[j,k]=c.useState(!1),[n,u]=c.useState({id:null,token:"",status:"Active",sub_admin_id:"",token_limit:0}),f=3,w=3e4;c.useEffect(()=>{a.length||x.get("/supper/fetch-subadmins").then(t=>{const r=t.data.data||t.data.subAdmins||[];console.log("Fetched SubAdmins:",r),Array.isArray(r)?h(r):console.warn("Unexpected sub-admin data format:",r)}).catch(t=>{console.error("Fetch failed:",t),l.error("Failed to fetch sub-admins")})},[a]),c.useEffect(()=>{i.length||x.get("/supper/tokens").then(t=>{const r=t.data.data||[];s(r)}).catch(t=>{console.error("Fetch tokens failed:",t),l.error("Failed to fetch tokens")})},[i]);const O=()=>{u({id:null,token:"",status:"Active",sub_admin_id:"",token_limit:0}),k(!1),b(!0)},F=t=>{u({id:t.id,token:t.token,status:t.status,sub_admin_id:t.sub_admin_id||"",token_limit:t.token_limit||0}),k(!0),b(!0)},D=async t=>{if(window.confirm("Are you sure?"))try{await x.delete(`/supper/tokens/${t}`),s(p.filter(r=>r.id!==t)),l.success("Token deleted")}catch(r){console.error("Delete failed:",r),l.error("Delete failed")}},g=t=>{u(r=>({...r,[t.target.name]:t.target.value}))},I=()=>Math.random().toString(36).substring(2,10).toUpperCase(),q=async t=>{var r,o;try{const{data:d}=await x.post(`/supper/tokens/${t}/regenerate`);s(y=>y.map(N=>N.id===t?{...N,...d.data}:N)),l.success("Token regenerated")}catch(d){l.error(((o=(r=d.response)==null?void 0:r.data)==null?void 0:o.message)||"Regeneration failed")}},L=async t=>{t.preventDefault();const r={...n,token_limit:parseInt(n.token_limit)||0,token_used:0};try{if(j){const{data:o}=await x.put(`/supper/tokens/${n.id}`,r);s(d=>d.map(y=>y.id===n.id?{...y,...o.data}:y)),l.success("Token updated")}else{const{data:o}=await x.post("/supper/tokens",r);s(d=>[...d,o.data]),l.success("Token created")}b(!1)}catch(o){console.error("Submit failed:",o),l.error("Submit failed")}};return e.jsxs("div",{className:"p-6 bg-white rounded shadow",children:[e.jsx($,{position:"top-center"}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Token Management"}),e.jsxs("button",{onClick:O,className:"bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2 text-sm",children:[e.jsx(M,{size:16})," Add Token"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b",children:"#"}),e.jsx("th",{className:"p-3 border-b",children:"SubAdmin"}),e.jsx("th",{className:"p-3 border-b",children:"Token"}),e.jsx("th",{className:"p-3 border-b",children:"Status"}),e.jsx("th",{className:"p-3 border-b",children:"Created"}),e.jsx("th",{className:"p-3 border-b",children:"Actions"}),e.jsx("th",{className:"p-3 border-b",children:"Limit"}),e.jsx("th",{className:"p-3 border-b",children:"Regen"})]})}),e.jsxs("tbody",{children:[p.map((t,r)=>{var o;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-b",children:r+1}),e.jsx("td",{className:"p-3 border-b",children:((o=t.sub_admin)==null?void 0:o.name)||"N/A"}),e.jsx("td",{className:"p-3 border-b font-mono",children:t.token}),e.jsx("td",{className:"p-3 border-b",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${t.status==="Active"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status})}),e.jsx("td",{className:"p-3 border-b",children:t.createdAt?new Date(t.createdAt).toLocaleString():"N/A"}),e.jsx("td",{className:"p-3 border-b",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{size:16,className:"text-blue-600 cursor-pointer",onClick:()=>F(t)}),e.jsx(V,{size:16,className:"text-red-600 cursor-pointer",onClick:()=>D(t.id)}),e.jsx("button",{onClick:()=>q(t.id),disabled:(t.regenCount||0)>=f,className:"text-xs bg-yellow-200 px-2 py-1 rounded disabled:opacity-50",children:"Regenerate"})]})}),e.jsx("td",{className:"p-3 border-b",children:t.token_limit>0?`${t.token_limit-(t.token_used||0)} / ${t.token_limit}`:"Unlimited"}),e.jsxs("td",{className:"p-3 border-b text-sm",children:["Regen: ",f-(t.regenCount||0),e.jsx("br",{}),t.lastRegenAt&&Date.now()-new Date(t.lastRegenAt).getTime()<w&&e.jsxs("div",{className:"text-xs text-gray-500",children:[Math.ceil((w-(Date.now()-new Date(t.lastRegenAt).getTime()))/1e3),"s cooldown"]})]})]},t.id)}),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center p-4 text-gray-500",children:"No tokens available."})})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:j?"Edit Token":"Add Token"}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Token"}),e.jsx("input",{name:"token",value:n.token,onChange:g,required:!0,className:"w-full border px-3 py-2 rounded text-sm"}),e.jsx("button",{type:"button",onClick:()=>u(t=>({...t,token:I()})),className:"text-xs text-blue-600 hover:underline mt-1",children:"Generate random token"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"SubAdmin"}),e.jsxs("select",{name:"sub_admin_id",value:n.sub_admin_id,onChange:g,required:!0,className:"w-full border px-3 py-2 rounded text-sm",children:[e.jsx("option",{value:"",children:"Select SubAdmin"}),a.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Status"}),e.jsxs("select",{name:"status",value:n.status,onChange:g,className:"w-full border px-3 py-2 rounded text-sm",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Expired",children:"Expired"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm",children:"Token Limit"}),e.jsx("input",{type:"number",name:"token_limit",value:n.token_limit,onChange:g,min:"0",className:"w-full border px-3 py-2 rounded text-sm"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"bg-gray-200 px-4 py-2 rounded text-sm",children:"Cancel"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded text-sm",disabled:!n.token||!n.sub_admin_id,children:j?"Update":"Create"})]})]})]})})]})}P.propTypes={initialTokens:E.array,subAdmins:E.array};function ce({subAdmins:i,initialTokens:m}){return e.jsx(U,{children:e.jsx(P,{subAdmins:i,initialTokens:m})})}export{ce as default};
