import{r as d,j as s}from"./app-Da_nhggM.js";import{a as k}from"./axiosInstance-BO4ZrsK3.js";function $({folder_id:m,admin_id:l,batch_id:u,refreshKey:_,onResultSubmitted:i}){const[o,b]=d.useState([]),[g,f]=d.useState(!0),[p,x]=d.useState({}),[M,S]=d.useState(""),[h,j]=d.useState(null);d.useEffect(()=>{if(!m||!l)return;(async()=>{try{const a=await k.get(`/admin/${l}/admit-cards/${m}/${u}`);b(a.data),x(r=>{const t={};return a.data.forEach(n=>{var c,N;t[n.id]={max_marks:((c=r[n.id])==null?void 0:c.max_marks)??n.max_marks??"",scored_marks:((N=r[n.id])==null?void 0:N.scored_marks)??n.scored_marks??""}}),t})}catch(a){console.error("Error fetching admit card data:",a)}finally{f(!1)}})()},[m,l,u,_]);const y=(e,a,r)=>{x(t=>({...t,[e]:{...t[e],[a]:r}}))},v=e=>{S(e),x(a=>{const r={};return Object.keys(a).forEach(t=>{r[t]={...a[t],max_marks:e}}),r})},E=e=>{const a=Number(e.max_marks),r=Number(e.scored_marks);return Number.isNaN(a)||Number.isNaN(r)?"Marks must be numbers.":a<=0?"Max marks must be greater than 0.":r<0?"Scored marks cannot be negative.":r>a?"Scored marks cannot exceed max marks.":null},C=async(e,a,r)=>{const t=E(a);if(t){alert(t);return}j(e);try{await k.post(`/admin/${l}/results`,{folder_id:m,batch_id:u,admin_id:l,admit_card_id:e,enrollment_number:r.enrollment_number,subject_name:r.subject_name,student_name:r.student_name,max_marks:Number(a.max_marks),scored_marks:Number(a.scored_marks),status:"pending"}),b(n=>n.map(c=>c.id===e?{...c,max_marks:a.max_marks,scored_marks:a.scored_marks}:c)),alert("Result submitted successfully!"),i&&i()}catch(n){console.error("Error submitting result:",n),alert("Failed to submit. Please try again.")}finally{j(null)}};return g?s.jsx("p",{children:"Loading..."}):o.length?s.jsxs("div",{className:"overflow-x-auto mt-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx("label",{className:"font-medium",children:"Bulk Max Marks:"}),s.jsx("input",{type:"number",value:M,onChange:e=>v(e.target.value),className:"border px-3 py-1 rounded"})]}),s.jsxs("table",{className:"min-w-full border border-gray-300 rounded-lg",children:[s.jsx("thead",{className:"bg-gray-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"border px-4 py-2",children:"Enrollment"}),s.jsx("th",{className:"border px-4 py-2",children:"Subject"}),s.jsx("th",{className:"border px-4 py-2",children:"Batch"}),s.jsx("th",{className:"border px-4 py-2",children:"Teacher"}),s.jsx("th",{className:"border px-4 py-2",children:"Student"}),s.jsx("th",{className:"border px-4 py-2",children:"Venue"}),s.jsx("th",{className:"border px-4 py-2",children:"Date"}),s.jsx("th",{className:"border px-4 py-2",children:"Max Marks"}),s.jsx("th",{className:"border px-4 py-2",children:"Scored Marks"}),s.jsx("th",{className:"border px-4 py-2",children:"Action"})]})}),s.jsx("tbody",{children:o.map(e=>{const a=p[e.id]||{};return s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"border px-4 py-2",children:e.enrollment_number}),s.jsx("td",{className:"border px-4 py-2",children:e.subject_name}),s.jsx("td",{className:"border px-4 py-2",children:e.batch_name}),s.jsx("td",{className:"border px-4 py-2",children:e.teacher_name}),s.jsx("td",{className:"border px-4 py-2",children:e.student_name}),s.jsx("td",{className:"border px-4 py-2",children:e.exam_venue}),s.jsx("td",{className:"border px-4 py-2",children:e.exam_date}),s.jsx("td",{className:"border px-2 py-1",children:s.jsx("input",{type:"number",value:a.max_marks??"",onChange:r=>y(e.id,"max_marks",r.target.value),className:"border rounded px-2 py-1 w-24"})}),s.jsx("td",{className:"border px-2 py-1",children:s.jsx("input",{type:"number",value:a.scored_marks??"",onChange:r=>y(e.id,"scored_marks",r.target.value),className:"border rounded px-2 py-1 w-24"})}),s.jsx("td",{className:"border px-4 py-2 text-center",children:s.jsx("button",{onClick:()=>C(e.id,p[e.id],{enrollment_number:e.enrollment_number,subject_name:e.subject_name,student_name:e.student_name}),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded disabled:opacity-60",disabled:h===e.id,children:h===e.id?"Saving...":"Submit"})})]},e.id)})})]})]}):s.jsx("p",{children:"No data available"})}export{$ as default};
