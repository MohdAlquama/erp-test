import{r,j as t}from"./app-Da_nhggM.js";import{A as I}from"./AdminLayout-BFQKyw_n.js";import{a as n}from"./axiosInstance-BO4ZrsK3.js";import{u as T}from"./adminContext-CI6wc_Go.js";import{c as d}from"./index-CgiR4QPD.js";import{C as U}from"./circle-plus-DQgevI2E.js";import{P}from"./pen-BI4ezAfj.js";import{T as O}from"./trash-2-D4oQZmeE.js";import"./menu-By4tiiDw.js";import"./createLucideIcon-Cl5mBFKr.js";import"./search-Cy0dovnH.js";import"./bell-Dmhy7b3m.js";import"./user-C3Ls9d9N.js";import"./x-Buk7JkW1.js";import"./house-BqJmp5lC.js";import"./users-SPycqOBZ.js";import"./graduation-cap-C0ne5fPE.js";import"./file-text-DJmdbdJJ.js";import"./settings-2yKiBYT4.js";import"./log-out-C0sdDckr.js";function z(){const{admin:a}=T(),[_,o]=r.useState(!1),[p,j]=r.useState(!1),[N,c]=r.useState(null),[v,F]=r.useState([]),[x,b]=r.useState(""),[f,h]=r.useState([null]),[g,y]=r.useState([]),[w,S]=r.useState([]),[u,m]=r.useState(null);r.useEffect(()=>{const e=async()=>{try{const s=await n.get(`/admin/${a.id}/batches`);F(s.data.batches||s.data||[])}catch{d.error("Failed to fetch batches")}};a!=null&&a.id&&e()},[a==null?void 0:a.id]);const k=async()=>{try{const e=await n.get(`/admin/${a.id}/syllabus`);S(e.data.syllabus||e.data||[])}catch{d.error("Failed to fetch syllabus")}};r.useEffect(()=>{a!=null&&a.id&&k()},[a==null?void 0:a.id]);const A=(e,s)=>{h(l=>{const i=[...l];return i[e]=s,i})},$=()=>h(e=>[...e,null]),E=e=>h(s=>s.filter((l,i)=>i!==e)),R=e=>{y(s=>s.filter(l=>l!==e))},B=async()=>{if(!x){c("Select a batch.");return}const e=new FormData;e.append("batch_id",x),g.forEach((s,l)=>e.append(`existing_files[${l}]`,s)),f.forEach((s,l)=>{s&&e.append(`files[${l}]`,s)}),j(!0);try{u?(await n.post(`/admin/${a.id}/syllabus/${u.id}`,e,{headers:{"Content-Type":"multipart/form-data"}}),d.success("Syllabus updated successfully!")):(await n.post(`/admin/${a.id}/syllabus`,e,{headers:{"Content-Type":"multipart/form-data"}}),d.success("Syllabus saved successfully!")),h([null]),y([]),b(""),o(!1),m(null),c(null),k()}catch(s){console.error(s),c("Failed to save syllabus.")}finally{j(!1)}},L=e=>{m(e),b(e.batch_id),h([null]),y(Array.isArray(e.file_path)?[...e.file_path]:[e.file_path]),o(!0)},D=async e=>{if(confirm("Are you sure you want to delete this syllabus?"))try{await n.delete(`/admin/${a.id}/syllabus/${e}`),d.success("Syllabus deleted successfully!"),S(s=>s.filter(l=>l.id!==e))}catch{d.error("Failed to delete syllabus.")}};return t.jsxs("div",{className:"p-6 bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold",children:"Syllabus Upload"}),t.jsxs("button",{onClick:()=>o(!0),className:"bg-indigo-600 text-white px-4 py-2 rounded flex items-center gap-2 hover:bg-indigo-700",disabled:p,children:[t.jsx(U,{className:"w-4 h-4"})," Add Syllabus"]})]}),t.jsxs("table",{className:"w-full table-auto border border-gray-300 dark:border-gray-700 mb-6",children:[t.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 border-b text-left",children:"Batch"}),t.jsx("th",{className:"p-2 border-b text-left",children:"File"}),t.jsx("th",{className:"p-2 border-b text-left",children:"Actions"})]})}),t.jsxs("tbody",{children:[w.map(e=>{const s=v.find(i=>i.id===e.batch_id);let l=[];return e.file_path&&(Array.isArray(e.file_path)?l=e.file_path.map(i=>i.split("/").pop()):typeof e.file_path=="string"&&(l=[e.file_path.split("/").pop()])),t.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[t.jsxs("td",{className:"p-2 border-b",children:[(s==null?void 0:s.name)||e.batch_id," ",s!=null&&s.grade?`(${s.grade})`:""]}),t.jsx("td",{className:"p-2 border-b",children:l.length>0?l.map((i,C)=>t.jsx("div",{className:"text-gray-700 dark:text-gray-300",children:t.jsx("a",{href:`${n.defaults.baseURL}/storage/${e.file_path[C]}`,target:"_blank",rel:"noreferrer",className:"underline hover:text-indigo-600",children:i})},C)):"N/A"}),t.jsxs("td",{className:"p-2 border-b flex gap-2",children:[t.jsxs("button",{onClick:()=>L(e),className:"text-green-600 hover:text-green-800 flex items-center gap-1",children:[t.jsx(P,{className:"w-4 h-4"})," Edit"]}),t.jsxs("button",{onClick:()=>D(e.id),className:"text-red-600 hover:text-red-800 flex items-center gap-1",children:[t.jsx(O,{className:"w-4 h-4"})," Delete"]})]})]},e.id)}),w.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:"3",className:"text-center p-4 text-gray-500",children:"No syllabus uploaded yet."})})]})]}),_&&t.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>{o(!1),m(null),c(null)}}),t.jsx("div",{className:"absolute right-0 top-0 h-full w-11/12 md:w-2/5 bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-lg overflow-y-auto",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-bold",children:u?"Edit Syllabus":"Add Syllabus"}),t.jsx("button",{onClick:()=>{o(!1),m(null),c(null)},className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Close"})]}),N&&t.jsx("div",{className:"mb-2 text-red-500",children:N}),t.jsxs("select",{value:x,onChange:e=>b(e.target.value),className:"w-full mb-4 border rounded p-2 bg-white dark:bg-gray-700",children:[t.jsx("option",{value:"",children:"-- Select Batch --"}),v.map(e=>t.jsxs("option",{value:e.id,children:[e.name," ",e.grade?`(${e.grade})`:""]},e.id))]}),g.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"font-semibold",children:"Existing Files:"}),g.map((e,s)=>t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsx("a",{href:`${n.defaults.baseURL}/storage/${e}`,target:"_blank",rel:"noreferrer",className:"underline hover:text-indigo-600",children:e.split("/").pop()}),t.jsx("button",{type:"button",onClick:()=>R(e),className:"text-red-600 hover:text-red-800 ml-2",children:"Remove"})]},s))]}),f.map((e,s)=>t.jsxs("div",{className:"mb-4 relative",children:[t.jsx("input",{type:"file",onChange:l=>A(s,l.target.files[0]),className:"w-full border rounded p-2 bg-white dark:bg-gray-700"}),f.length>1&&t.jsx("button",{type:"button",onClick:()=>E(s),className:"absolute top-2 right-2 text-red-600 hover:text-red-800",children:"Remove"})]},s)),t.jsxs("div",{className:"flex gap-3 mt-2",children:[t.jsx("button",{type:"button",onClick:$,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Add Another File"}),t.jsx("button",{type:"button",onClick:B,className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700",disabled:p,children:p?"Saving...":u?"Update":"Save All"})]})]})})]})]})}z.layout=a=>t.jsx(I,{children:a});export{z as default};
