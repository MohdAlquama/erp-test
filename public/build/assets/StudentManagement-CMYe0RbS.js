import{r as o,j as e}from"./app-DVKDYkXn.js";import{A as q}from"./AdminLayout-xaFDPYzW.js";import{u as G}from"./adminContext-PWhikkwe.js";import{a as p}from"./axiosInstance-DbG8c_Wf.js";import{P as V}from"./plus-DVonVEYX.js";import{P as W}from"./pen-DrgX0o2U.js";import{T as X}from"./trash-2-DbrrDeOm.js";import{X as H}from"./x-BXpkOE8a.js";import"./index-Cz5qM-jY.js";import"./menu-CmgxFT07.js";import"./createLucideIcon-V0M9PHiF.js";import"./search-CWxSpjiP.js";import"./bell-BPh2_WIZ.js";import"./user-0Ob6j4Ad.js";import"./house-CAgWt0V0.js";import"./users-DYTZw1Iw.js";import"./graduation-cap-DP4x_y6M.js";import"./file-text-BNaR_w6u.js";import"./settings-DfQ06Dqm.js";import"./log-out-mnJCr85j.js";const J=()=>{const{admin:d}=G(),A=!0,[E,x]=o.useState([{}]),[h,k]=o.useState([]),[K,P]=o.useState([]),[Q,$]=o.useState([]),[u,N]=o.useState(!0),[v,_]=o.useState(null),[F,f]=o.useState(!1),[b,D]=o.useState(""),[j,I]=o.useState("All"),[w,S]=o.useState(null),[s,g]=o.useState({name:"",email:"",enrollment_number:"",contact_number:"",password:"",status:"Active",batch_ids:"",subject_ids:[],teacher_ids:[],dob:"",gender:"",session:"",father_name:"",profile_image:null}),[m,C]=o.useState(null);o.useEffect(()=>{d!=null&&d.id&&p.get(`admin/${d.id}/students`).then(t=>{x(t.data.data),console.log(t.data.data)}).catch(t=>console.error("Error fetching students:",t))},[d]),o.useEffect(()=>{const t=async()=>{N(!0),_(null);try{const[n,a,r]=await Promise.all([p.get(`/admin/${d.id}/teachers`),p.get(`/admin/${d.id}/batches`),p.get(`/admin/${d.id}/subjects`)]);P(n.data.teachers),k(a.data),$(r.data)}catch(n){_("Failed to fetch data. Please try again later."),console.error("API Error:",n)}finally{N(!1)}};d.id&&t()},[d.id]);const i=t=>{const{name:n,value:a}=t.target;g(r=>({...r,[n]:a}))},L=(t,n)=>{const{value:a,checked:r}=t.target;g(l=>{const c=l[n]||[];return r?{...l,[n]:[...c,a]}:{...l,[n]:c.filter(U=>U!==a)}})},T=()=>!s.name||!s.email||!s.enrollment_number?(alert("Name, Email, and Enrollment Number are required"),!1):s.contact_number&&!/^\d{10}$/.test(s.contact_number)?(alert("Contact number must be a valid 10-digit number"),!1):s.dob===""?(alert("Date of Birth is required"),!1):s.gender===""?(alert("Please select a gender"),!1):!0,B=async()=>{var t,n;if(T())try{const a=new FormData;a.append("admin_id",d.id),a.append("name",s.name),a.append("email",s.email),a.append("enrollment_number",s.enrollment_number),a.append("contact_number",s.contact_number),a.append("status",s.status),a.append("session",s.session||""),a.append("father_name",s.father_name||""),a.append("dob",s.dob||""),a.append("gender",s.gender||""),a.append("batch_ids",s.batch_ids||""),!m&&s.password&&a.append("password",s.password),w&&a.append("profile_image",w);let r;m?(a.append("_method","PUT"),r=await p.post(`/admin/students/${m.id}`,a,{headers:{"Content-Type":"multipart/form-data"}})):r=await p.post("/admin/student",a,{headers:{"Content-Type":"multipart/form-data"}}),x(m?l=>l.map(c=>c.id===m.id?r.data.data:c):l=>[...l,r.data.data]),f(!1),y()}catch(a){console.error("Error saving student:",((t=a.response)==null?void 0:t.data)||a),alert(((n=a.response)==null?void 0:n.data.message)||"Failed to save student")}},M=t=>{C(t);const n=t.batch_id&&h.find(a=>a.id===t.batch_id)?t.batch_id.toString():"";g({profile_image:t.profile_image,name:t.name||"",father_name:t.father_name||"",email:t.email||"",enrollment_number:t.enrollment_number||"",contact_number:t.contact_number||"",session:t.session||"",dob:t.dob||"",gender:t.gender||"",password:"",status:t.status||"Active",batch_ids:n}),S(null),f(!0)},z=async(t,n)=>{var a,r;if(window.confirm("Are you sure you want to delete this student?"))try{await p.delete(`/admin/${d.id}/students/${t}`,{data:{enrollment_number:n}}),x(l=>l.filter(c=>c.id!==t)),alert("Student deleted successfully")}catch(l){console.error("Failed to delete student:",((a=l.response)==null?void 0:a.data)||l),alert(((r=l.response)==null?void 0:r.data.message)||"Failed to delete student")}},y=()=>{f(!1),C(null),g({name:"",email:"",enrollment_number:"",contact_number:"",password:"",status:"Active",batch_ids:[],session:"",father_name:""})},O=E.filter(t=>{var r,l,c;const n=((r=t.name)==null?void 0:r.toLowerCase().includes(b.toLowerCase()))||((l=t.email)==null?void 0:l.toLowerCase().includes(b.toLowerCase()))||((c=t.enrollment_number)==null?void 0:c.toLowerCase().includes(b.toLowerCase())),a=j==="All"||t.status===j;return n&&a}),R=({status:t})=>e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t==="Active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t});return e.jsxs("div",{className:"p-4",children:[u&&e.jsx("div",{className:"text-center",children:"Loading..."}),v&&e.jsx("div",{className:"text-center text-red-600",children:v}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Student Management"}),e.jsxs("button",{onClick:()=>f(!0),className:"bg-blue-500 text-white px-4 py-2 rounded flex items-center gap-1",disabled:u,children:[e.jsx(V,{size:16}),"Add Student"]})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("input",{value:b,onChange:t=>D(t.target.value),placeholder:"Search by name, email, or enrollment...",className:"p-2 border rounded",disabled:u}),e.jsxs("select",{value:j,onChange:t=>I(t.target.value),className:"p-2 border rounded",disabled:u,children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg shadow border",children:e.jsxs("table",{className:"min-w-full bg-white divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:["                            ",e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"img"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"id"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Enrollment No."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Batches"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:O.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-4 min-w-0",children:t.profile_image?e.jsx("img",{src:t.profile_image.startsWith("http")?t.profile_image:`http://127.0.0.1:8000/storage/${t.profile_image.replace("public/storage/","")}`,alt:`${t.name}'s profile`,className:"w-10 h-10 rounded-full object-cover",onError:n=>{console.error(`Failed to load image: ${t.profile_image}`),n.target.src="https://via.placeholder.com/40"}}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-500 text-xs",children:"No Image"})}),"      ",e.jsx("td",{className:"px-6 py-4",children:t.id}),e.jsx("td",{className:"px-6 py-4",children:t.name}),e.jsx("td",{className:"px-6 py-4",children:t.email}),e.jsx("td",{className:"px-6 py-4",children:t.enrollment_number}),e.jsx("td",{className:"px-6 py-4",children:t.contact_number||"-"}),e.jsxs("td",{className:"px-6 py-4 space-x-1",children:["    ",(()=>{const n=h.find(a=>a.id===t.batch_ids);return n?n.name:"Unknown"})()]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(R,{status:t.status})}),e.jsxs("td",{className:"px-6 py-4 space-x-2",children:[e.jsx("button",{onClick:()=>M(t),className:"text-blue-600 hover:text-blue-900",children:e.jsx(W,{size:16})}),e.jsx("button",{onClick:()=>z(t.id,t.enrollment_number),className:"text-red-600 hover:text-red-900",children:e.jsx(X,{size:16})})]})]},t.id))})]})}),F&&A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex justify-end z-50",onClick:y,children:e.jsxs("div",{className:"w-full max-w-md bg-white h-full p-6 overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:m?"Edit Student":"Add Student"}),e.jsx("button",{onClick:y,children:e.jsx(H,{})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:t=>S(t.target.files[0]),className:"w-full p-2 border rounded text-sm"}),e.jsx("input",{type:"text",name:"name",placeholder:"Name",value:s.name,onChange:i,className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",name:"father_name",placeholder:"father_name",value:s.father_name,onChange:i,className:"w-full p-2 border rounded"}),e.jsx("input",{type:"date",name:"dob",placeholder:"Date of Birth",value:s.dob,onChange:i,className:"w-full p-2 border rounded"}),e.jsxs("select",{name:"gender",value:s.gender,onChange:i,className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsx("input",{type:"email",name:"email",placeholder:"Email",value:s.email,onChange:i,className:"w-full p-2 border rounded"}),!m&&e.jsx("input",{type:"password",name:"password",placeholder:"Password",value:s.password,onChange:i,className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",name:"enrollment_number",placeholder:"Enrollment Number",value:s.enrollment_number,onChange:i,className:"w-full p-2 border rounded"}),e.jsx("input",{type:"number",name:"session",placeholder:"Session Number",value:s.session,onChange:i,className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",name:"contact_number",placeholder:"Contact Number",value:s.contact_number,onChange:i,className:"w-full p-2 border rounded"}),e.jsxs("select",{name:"status",value:s.status,onChange:i,className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Inactive",children:"Inactive"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Batches"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto p-2 border rounded",children:[h.map(t=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",value:t.id.toString(),checked:s.batch_ids.includes(t.id.toString()),onChange:n=>L(n,"batch_ids"),disabled:u,className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),e.jsx("span",{children:t.name})]},t.id)),h.length===0&&!u&&e.jsx("p",{className:"text-sm text-red-600",children:"No batches available"})]})]}),e.jsx("button",{onClick:B,className:"bg-blue-500 text-white w-full py-2 rounded",disabled:u,children:m?"Update Student":"Add Student"})]})]})})]})};J.layout=d=>e.jsx(q,{children:d});export{J as default};
