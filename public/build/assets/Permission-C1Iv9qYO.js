import{r,j as e}from"./app-DVKDYkXn.js";import{S as I}from"./SupperAdminLayout-lTWtW5b5.js";import{a as C}from"./axiosInstance-DbG8c_Wf.js";import{X as R}from"./x-BXpkOE8a.js";import{L}from"./Loader-C4u9qc36.js";import{M as T,i as V,u as $,P as G,a as H,b as U,L as W,m as q}from"./proxy-ZxX4twAY.js";import{P as K}from"./plus-DVonVEYX.js";import{E as X}from"./eye-_gK50MUw.js";import{S as _}from"./square-pen-CPYWtBBB.js";import{T as B}from"./trash-2-DbrrDeOm.js";import"./createLucideIcon-V0M9PHiF.js";import"./search-CWxSpjiP.js";import"./bell-BPh2_WIZ.js";import"./settings-DfQ06Dqm.js";import"./clsx-B-dksMZM.js";import"./layout-dashboard-z_EU-noV.js";import"./log-out-mnJCr85j.js";import"./index-Cz5qM-jY.js";import"./loader-circle-DwFdk6Mg.js";class J extends r.Component{getSnapshotBeforeUpdate(x){const s=this.props.childRef.current;if(s&&x.isPresent&&!this.props.isPresent){const i=s.offsetParent,g=V(i)&&i.offsetWidth||0,a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft,a.right=g-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function O({children:l,isPresent:x,anchorX:s,root:i}){const g=r.useId(),a=r.useRef(null),c=r.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=r.useContext(T);return r.useInsertionEffect(()=>{const{width:w,height:n,top:m,left:o,right:f}=c.current;if(x||!a.current||!w||!n)return;const b=s==="left"?`left: ${o}`:`right: ${f}`;a.current.dataset.motionPopId=g;const h=document.createElement("style");p&&(h.nonce=p);const t=i??document.head;return t.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${g}"] {
            position: absolute !important;
            width: ${w}px !important;
            height: ${n}px !important;
            ${b}px !important;
            top: ${m}px !important;
          }
        `),()=>{t.removeChild(h),t.contains(h)&&t.removeChild(h)}},[x]),e.jsx(J,{isPresent:x,childRef:a,sizeRef:c,children:r.cloneElement(l,{ref:a})})}const Q=({children:l,initial:x,isPresent:s,onExitComplete:i,custom:g,presenceAffectsLayout:a,mode:c,anchorX:p,root:w})=>{const n=$(Y),m=r.useId();let o=!0,f=r.useMemo(()=>(o=!1,{id:m,initial:x,isPresent:s,custom:g,onExitComplete:b=>{n.set(b,!0);for(const h of n.values())if(!h)return;i&&i()},register:b=>(n.set(b,!1),()=>n.delete(b))}),[s,n,i]);return a&&o&&(f={...f}),r.useMemo(()=>{n.forEach((b,h)=>n.set(h,!1))},[s]),r.useEffect(()=>{!s&&!n.size&&i&&i()},[s]),c==="popLayout"&&(l=e.jsx(O,{isPresent:s,anchorX:p,root:w,children:l})),e.jsx(G.Provider,{value:f,children:l})};function Y(){return new Map}const P=l=>l.key||"";function z(l){const x=[];return r.Children.forEach(l,s=>{r.isValidElement(s)&&x.push(s)}),x}const Z=({children:l,custom:x,initial:s=!0,onExitComplete:i,presenceAffectsLayout:g=!0,mode:a="sync",propagate:c=!1,anchorX:p="left",root:w})=>{const[n,m]=H(c),o=r.useMemo(()=>z(l),[l]),f=c&&!n?[]:o.map(P),b=r.useRef(!0),h=r.useRef(o),t=$(()=>new Map),[u,d]=r.useState(o),[y,N]=r.useState(o);U(()=>{b.current=!1,h.current=o;for(let k=0;k<y.length;k++){const j=P(y[k]);f.includes(j)?t.delete(j):t.get(j)!==!0&&t.set(j,!1)}},[y,f.length,f.join("-")]);const S=[];if(o!==u){let k=[...o];for(let j=0;j<y.length;j++){const v=y[j],M=P(v);f.includes(M)||(k.splice(j,0,v),S.push(v))}return a==="wait"&&S.length&&(k=S),N(z(k)),d(o),null}const{forceRender:E}=r.useContext(W);return e.jsx(e.Fragment,{children:y.map(k=>{const j=P(k),v=c&&!n?!1:o===y||f.includes(j),M=()=>{if(t.has(j))t.set(j,!0);else return;let F=!0;t.forEach(A=>{A||(F=!1)}),F&&(E==null||E(),N(h.current),c&&(m==null||m()),i&&i())};return e.jsx(Q,{isPresent:v,initial:!b.current||s?void 0:!1,custom:x,presenceAffectsLayout:g,mode:a,root:w,onExitComplete:v?void 0:M,anchorX:p,children:k},j)})})};function D({group:l,onClose:x}){return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg w-full max-w-md mx-4 p-6 relative",children:[e.jsx("button",{onClick:x,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white",children:e.jsx(R,{size:20})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-4",children:l.feature}),e.jsx("ul",{className:"list-disc pl-6 space-y-1 text-gray-700 dark:text-gray-300",children:l.permissions.map((s,i)=>e.jsx("li",{children:s},i))}),e.jsx("div",{className:"mt-6 text-right",children:e.jsx("button",{onClick:x,className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"Close"})})]})}):null}function ee({onClose:l,onSave:x,editData:s=null,loading:i}){const[g,a]=r.useState((s==null?void 0:s.feature)||""),[c,p]=r.useState((s==null?void 0:s.permissions)||[""]),[w,n]=r.useState(""),m=r.useRef(),o=(t,u)=>{const d=[...c];d[t]=u,p(d),w&&n("")},f=()=>{p([...c,""])},b=t=>{c.length>1&&p(c.filter((u,d)=>d!==t))},h=async t=>{t.preventDefault();const u=c.filter(y=>y.trim()!=="");if(!g.trim()||u.length===0){n("Feature and at least one permission are required.");return}const d={feature:g.trim(),permissions:u};await x(d,s==null?void 0:s.id),a(""),p([""]),n("")};return r.useEffect(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[c.length]),e.jsx(Z,{children:e.jsxs(q.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween",duration:.3},className:"fixed top-0 right-0 h-full w-full max-w-md bg-white dark:bg-gray-900 shadow-lg z-50 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 border-b border-gray-200 dark:border-gray-700 shrink-0",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:s?"Edit Permission":"Add Permission"}),e.jsx("button",{onClick:l,disabled:i,children:e.jsx(R,{className:"text-gray-600 dark:text-gray-300"})})]}),e.jsxs("form",{onSubmit:h,ref:m,className:"p-6 space-y-4 overflow-y-auto flex-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Feature / Module Name"}),e.jsx("input",{type:"text",placeholder:"e.g., User Management",value:g,onChange:t=>a(t.target.value),className:"mt-1 w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded bg-white dark:bg-gray-800 text-gray-800 dark:text-white",disabled:i})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Permissions"}),c.map((t,u)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"e.g., View",value:t,onChange:d=>o(u,d.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded bg-white dark:bg-gray-800 text-gray-800 dark:text-white",disabled:i}),c.length>1&&e.jsx("button",{type:"button",onClick:()=>b(u),className:"text-red-600 hover:text-red-800",disabled:i,children:e.jsx(R,{size:18})})]},u)),e.jsxs("button",{type:"button",onClick:f,className:"flex items-center gap-2 text-indigo-600 dark:text-indigo-400 hover:underline",disabled:i,children:[e.jsx(K,{size:18}),"Add another permission"]})]}),w&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:w}),i&&e.jsx(L,{message:"Saving..."}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition disabled:opacity-50",disabled:i,children:"Save"})})]})]})})}function te(){const[l,x]=r.useState([]),[s,i]=r.useState(!1),[g,a]=r.useState(null),[c,p]=r.useState(null),[w,n]=r.useState(""),[m,o]=r.useState(!1),f=async()=>{var t,u;o(!0);try{const d=await C.get("/supper/permission-list");x(d.data),n("")}catch(d){n(((u=(t=d.response)==null?void 0:t.data)==null?void 0:u.error)||"Failed to fetch permissions. Please try again."),console.error(d)}finally{o(!1)}};r.useEffect(()=>{f()},[]);const b=async(t,u)=>{var d,y;o(!0);try{u?await C.put(`/supper/permission/${u}`,t):await C.post("/supper/permission",t),f(),i(!1),p(null),n("")}catch(N){n(((y=(d=N.response)==null?void 0:d.data)==null?void 0:y.error)||"Failed to save permission. Please try again."),console.error(N)}finally{o(!1)}},h=async t=>{var u,d;if(window.confirm("Are you sure you want to delete this permission?")){o(!0);try{await C.delete(`/supper/permission/${t}`),f(),n("")}catch(y){n(((d=(u=y.response)==null?void 0:u.data)==null?void 0:d.error)||"Failed to delete permission. Please try again."),console.error(y)}finally{o(!1)}}};return e.jsxs("div",{className:"p-6 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800 dark:text-white",children:"Permissions"}),e.jsx("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition disabled:opacity-50",disabled:m,children:"Add Permission"})]}),w&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mb-4",children:w}),m&&e.jsx(L,{message:"Processing..."}),!m&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto border border-gray-200 dark:border-gray-700 text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-b dark:border-gray-700 text-left",children:"Module"}),e.jsx("th",{className:"px-4 py-3 border-b dark:border-gray-700 text-left",children:"Permissions"}),e.jsx("th",{className:"px-4 py-3 border-b dark:border-gray-700 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"px-4 py-4 text-center text-gray-500 dark:text-gray-400",children:"No permissions added yet."})}):l.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition",children:[e.jsx("td",{className:"px-4 py-3 text-gray-800 dark:text-white font-medium",children:t.feature}),e.jsx("td",{className:"px-4 py-3 text-gray-600 dark:text-gray-300",children:t.permissions.join(", ")}),e.jsxs("td",{className:"px-4 py-3 flex gap-3 text-indigo-600 dark:text-indigo-400",children:[e.jsx("button",{onClick:()=>a(t),title:"View",disabled:m,children:e.jsx(X,{className:"w-5 h-5 hover:text-blue-600"})}),e.jsx("button",{onClick:()=>{p(t),i(!0)},title:"Edit",disabled:m,children:e.jsx(_,{className:"w-5 h-5 hover:text-yellow-600"})}),e.jsx("button",{onClick:()=>h(t.id),title:"Delete",disabled:m,children:e.jsx(B,{className:"w-5 h-5 hover:text-red-600"})})]})]},t.id))})]})}),g&&e.jsx(D,{group:g,onClose:()=>a(null)}),s&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{onClose:()=>{i(!1),p(null)},onSave:b,editData:c,loading:m}),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm z-40",onClick:()=>{i(!1),p(null)}})]})]})}function we(){return e.jsx(I,{children:e.jsx(te,{})})}export{we as default};
